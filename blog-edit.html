<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Blog Post</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body style="background:#020817;">
    <div class="container mt-5" style="max-width:600px;">
        <h2 class="mb-4 text-white" id="editTitle">Create Blog Post</h2>
        <form id="editBlogForm">
            <input type="hidden" id="blogId">
            <div class="form-group">
                <label class="text-white">Header</label>
                <input type="text" class="form-control" id="blogHeader" required>
            </div>
            <div class="form-group">
                <label class="text-white">Title</label>
                <input type="text" class="form-control" id="blogTitle" required>
            </div>
            <div class="form-group">
                <label class="text-white">Description</label>
                <input type="text" class="form-control" id="blogDesc" required>
            </div>
            <div class="form-group">
                <label class="text-white">Image URL</label>
                <input type="text" class="form-control" id="blogImage" required>
            </div>
            <div class="form-group">
                <label class="text-white">Text</label>
                <textarea class="form-control" id="blogText" rows="5" required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Save Blog</button>
            <a href="index.html" class="btn btn-secondary ml-2">Cancel</a>
        </form>
        <button id="createBlogBtn" class="btn btn-success">+ Create Post</button>
    </div>
    <script>
        // Parse query string for ?id=...
        function getQueryId() {
            const params = new URLSearchParams(window.location.search);
            return params.get('id');
        }
        const blogId = getQueryId();
        if (blogId) {
            document.getElementById('editTitle').textContent = 'Edit Blog Post';
            const blogs = JSON.parse(localStorage.getItem('myBlogs') || '[]');
            const blog = blogs.find(b => b.id == blogId);
            if (blog) {
                document.getElementById('blogId').value = blog.id;
                document.getElementById('blogHeader').value = blog.header;
                document.getElementById('blogTitle').value = blog.title;
                document.getElementById('blogDesc').value = blog.description;
                document.getElementById('blogImage').value = blog.image;
                document.getElementById('blogText').value = blog.text;
            }
        }

        // Prevent non-admins from submitting
        document.getElementById('editBlogForm').onsubmit = async function(e) {
            if (localStorage.getItem('isAdmin') !== 'true') {
                alert('Only admin can create posts.');
                e.preventDefault();
                return false;
            }
            e.preventDefault();
            let blogs = JSON.parse(localStorage.getItem('myBlogs') || '[]');
            const id = document.getElementById('blogId').value || Date.now();
            const blog = {
                id: Number(id),
                header: document.getElementById('blogHeader').value,
                title: document.getElementById('blogTitle').value,
                description: document.getElementById('blogDesc').value,
                image: document.getElementById('blogImage').value,
                text: document.getElementById('blogText').value
            };
            const idx = blogs.findIndex(b => b.id === Number(id));
            if (idx > -1) blogs[idx] = blog;
            else blogs.unshift(blog);
            localStorage.setItem('myBlogs', JSON.stringify(blogs));
            window.location.href = 'index.html#blogs';
        };

        document.getElementById('createBlogBtn').onclick = function() {
            window.location.href = 'edit.html';
        };

    </script>
</body>
</html>